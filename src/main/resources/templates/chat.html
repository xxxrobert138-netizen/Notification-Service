<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Чат</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #e0e7ef;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 700px;
            margin: auto;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            overflow: hidden;
            background-color: #ffffff;
            margin: 10px; /* немного отступа по бокам для мобильных */
        }

        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #f4f6f8;
        }

        /* Стиль сообщений */
        .message {
            max-width: 70%;
            margin-bottom: 12px;
            padding: 12px 16px;
            border-radius: 20px;
            font-size: 16px;
            line-height: 1.4;
            position: relative;
            word-wrap: break-word;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            opacity: 0; /* для анимации появления */
            transform: translateY(20px);
        }

        /* Сообщения пользователя */
        .message.user {
            background-color: #4facfe; /* голубой градиент */
            color: #fff;
            align-self: flex-end;
            border-bottom-right-radius: 4px; /* чуть скруглить угол */
        }

        /* Сообщения бота */
        .message.bot {
            background-color: #d9d9d9; /* светло-серый */
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 4px; /* чуть скруглить угол */
        }

        @keyframes fadeInUp {
          to {
              opacity: 1;
              transform: translateY(0);
          }
        }

        /* Область ввода и кнопка - адаптивно для мобильных */
        .input-area {
                display:flex;
                padding:15px 20px;
                border-top:1px solid #ccc8c8;
                background-color:#fff;

                /* Для мобильных делаем колонку при узкой ширине */
                flex-direction:flex-row;
                align-items:center;
                gap:10px;
                flex-wrap:no-wrap;
        }

        input[type="text"] {
                flex-grow:auto;
                flex-basis:auto;
                min-width:auto;
                width:auto;
                padding:12px 20px;
                font-size:16px;
                border-radius:25px;
                border:none;

                box-shadow:
                    inset -2px -2px 5px rgba(255,255,255,0.6),
                    inset 2px 2px 5px rgba(0,0,0,0.1);

                transition:.2s all ease-in-out;

                outline:none;

                background-color:#f0f3f7;

                /* Сделать ширину адаптивной на мобильных */
                width:auto;
                max-width:none;
        }
        input[type="text"]:focus {
                 box-shadow:
                     inset -2px -2px 5px rgba(255,255,255,0.8),
                     inset 2px 2px 5px rgba(0,0,0,0.15);
             }

         button {
                 padding:12px 24px;
                 background-color:#4facfe;
                 color:#fff;
                 border:none;
                 cursor:pointer;
                 font-size :16 px ;

                 border-radius:px;

                 box-shadow:
                     inset -2 px -2 px5 px rgba (255 ,255 ,255 ,0.6),
                     inset2 px2 px5 px rgba (0 ,0 ,0 ,0.1);

                 transition : all .2 s ease-in-out ;

                 border-radius :25px;

                 /* Для мобильных сделать кнопку чуть больше и адаптивной по ширине */
                 min-width:auto;
             }
         button:hover {
                 background-color:#3a9bfc ;
             }

         /* Адаптация для мобильных устройств */
         @media(max-width:600px){
             .chat-container{
                 margin:auto !important; /* чтобы не было лишних отступов на маленьких экранах */
             }
             .input-area{
                 flex-direction:flex-column-reverse; /* чтобы кнопка была под полем ввода на мобилках */
                 align-items:flex-start; /* выравнивание по левому краю */
             }
             input[type="text"]{
                 width:"100%"; /* занимает всю ширину контейнера */
             }
             button{
                 width:"100%"; /* занимает всю ширину блока ввода при мобилках */
             }
         }
    </style>
</head>
<body>
<div class="chat-container">
    <div class="messages" id="messages"></div>
    <div class="input-area">
        <input type="text" id="messageInput" placeholder="Введите сообщение..."/>
        <button id="sendButton">Отправить</button>
    </div>
</div>

<!-- Подключение stomp.js и SockJS -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
    const messagesDiv = document.getElementById('messages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');

    let id = null;

    let stompClient = null;

    // Функция для добавления сообщения
    function addMessage(text, sender) {
        if (!text || text.trim() === '') return;

        const messageDiv = document.createElement('div');
        messageDiv.className = 'message ' + sender; // 'user' или 'bot'
        messageDiv.textContent = text;

        // Добавляем с эффектом появления
        messageDiv.style.opacity = '0';
        messageDiv.style.transform = 'translateY(20px)';

        messagesDiv.appendChild(messageDiv);

        // Прокрутка к последнему сообщению
        messagesDiv.scrollTop = messagesDiv.scrollHeight;

        // Анимация появления
        setTimeout(() => {
          messageDiv.style.opacity = '1';
          messageDiv.style.transform = 'translateY(0)';
          messageDiv.style.transition = 'all 0.3s ease-in-out';
        },10);
    }

    // Подключение к серверу через SockJS и STOMP
    function connect() {
    const socket = new SockJS('/connect'); // Укажите правильный путь к вашему WebSocket эндпоинту
    stompClient = Stomp.over(socket);

    stompClient.connect({}, function(frame) {
    console.log('Connected:', frame);
    // Подписка на канал для получения сообщений
    stompClient.subscribe('/topic/messages', function(messageOutput) {
    const messageData = JSON.parse(messageOutput.body);
    addMessage(messageData.text, 'bot');
    });
    // Можно подписаться на другие каналы или отправлять сообщения
    // Например, отправлять сообщения на /app/chat
    window.stompClient = stompClient;
    // Сообщение о подключении
    addMessage('Соединено с сервером', 'bot');
    }, function(error) {
    console.error('Ошибка подключения:', error);
    addMessage('Ошибка подключения к серверу', 'bot');
    // Повторное подключение через некоторое время
    setTimeout(connect,5000);
    });
    }

    function enableUI() { sendButton.disabled=false; messageInput.disabled=false;}
    function disableUI() { sendButton.disabled=true; messageInput.disabled=true;}

    function sendMessage() {
    const text=messageInput.value.trim();
    if(text===''||!stompClient||!stompClient.connected)return;

    const messageData={text:text};

    // Отправка на сервер по маршруту
    stompClient.send('/chat/send',{},JSON.stringify(messageData));

    addMessage(text,'user');
    messageInput.value='';
    }

    sendButton.addEventListener('click',sendMessage);

    messageInput.addEventListener('keydown',function(e){
    if(e.key==='Enter'){
    sendMessage();
    e.preventDefault();
    }
    });

    // Инициализация соединения при загрузке страницы
    window.onload=()=>{connect();};
</script>
</body>
</html>